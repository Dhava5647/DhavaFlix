<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DhavaFlix – Watch Movies & Webseries</title>
    
    <!-- SEO, AdSense & Branding Meta Tags -->
    <meta name="title" content="DhavaFlix – Watch Movies & Webseries">
    <meta name="description" content="Stream and explore movies & webseries free. DhavaFlix looks like Netflix but is powered by the TMDB API.">
    <meta name="keywords" content="movies, webseries, streaming, netflix clone, tmdb, dhavaflix">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="DhavaFlix – Watch Movies & Webseries">
    <meta property="og:description" content="A Netflix-style streaming site to explore the latest movies and TV shows, complete with trailers, ratings, and personalized lists.">
    <meta property="og:image" content="https://i.imgur.com/392o636.png"> 
    <meta name="theme-color" content="#101010">
    <meta property="og:url" content="">
    <meta property="twitter:card" content="summary_large_image">

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎬</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --midnight-bg: #101010;
            --electric-blue: #0072F5;
            --electric-blue-light: #00C6FF;
            --text-primary-dark: #FFFFFF;
            --card-bg-dark: #1a202c;
        }
        html:not(.light) { background-color: var(--midnight-bg); }
        body { background-color: var(--midnight-bg); color: var(--text-primary-dark); font-family: 'Poppins', sans-serif; overflow-x: hidden; transition: background-color 0.3s, color 0.3s; padding-bottom: 60px; }
        
        /* Light Mode Styles */
        html.light body { background-color: #f1f5f9; color: #1e293b; }
        html.light .themed-bg { background-color: #f1f5f9; }
        html.light .themed-text { color: #1e293b; }
        html.light .header-scrolled { background-color: rgba(241, 245, 249, 0.85); border-bottom: 1px solid #e2e8f0; }
        html.light #mobile-menu { background-color: rgba(241, 245, 249, 0.9); }
        html.light #logo-text { fill: #1e293b; }
        html.light .shimmer { background: linear-gradient(90deg, #e2e8f0 25%, #f1f5f9 50%, #e2e8f0 75%); }
        html.light .modal-content, html.light .profile-card, html.light .reminder-item { background-color: #ffffff; }
        html.light .carousel-arrow, html.light #close-video { background-color: rgba(0,0,0,0.5); color: white; }
        html.light .bottom-nav { background-color: #ffffff; border-top: 1px solid #e2e8f0; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background-color: var(--electric-blue); border-radius: 8px; }
        .header-scrolled { background-color: rgba(16, 16, 16, 0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        .hero-gradient { background: linear-gradient(to top, var(--midnight-bg) 5%, transparent 50%), linear-gradient(to right, rgba(16, 16, 16, 0.9) 0%, transparent 80%); }
        html.light .hero-gradient { background: linear-gradient(to top, #f1f5f9 5%, transparent 50%), linear-gradient(to right, rgba(241, 245, 249, 0.9) 0%, transparent 80%); }
        .hero-text-shadow { text-shadow: 2px 2px 15px rgba(0, 0, 0, 0.9); }
        html.light .hero-text-shadow { text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.3); }
        .carousel-container:hover .carousel-arrow { opacity: 1; }
        .carousel-arrow { opacity: 0; transition: opacity 0.3s ease; }
        .carousel-arrow:hover { background-color: rgba(20, 20, 20, 0.8); }
        #mobile-menu { transition: transform 0.3s ease-in-out; background-color: rgba(0,0,0,0.9); backdrop-filter: blur(10px); }
        .movie-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .group:hover .movie-card { transform: scale(1.05); z-index: 10; box-shadow: 0 0 30px -5px var(--electric-blue); }
        .search-overlay { backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .nav-link.active { color: var(--electric-blue-light); font-weight: 600; }
        .shimmer { background: linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.15) 50%, rgba(255,255,255,0.06) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .quality-badge { position: absolute; top: 8px; left: 8px; background-color: rgba(0,0,0,0.7); color: white; padding: 2px 6px; font-size: 10px; font-weight: bold; border-radius: 4px; z-index: 5; }
        .reminder-bell.active { color: var(--electric-blue-light); }
        .progress-bar { height: 4px; background-color: var(--electric-blue); }
    </style>
</head>
<body class="themed-bg">

    <!-- HEADER -->
    <header id="main-header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center space-x-8">
                    <a href="#" aria-label="DhavaFlix Home" class="nav-link" data-view="home">
                        <svg width="150" height="38" viewBox="0 0 150 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                           <defs><linearGradient id="logo-gradient" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="var(--electric-blue-light)"/><stop offset="100%" stop-color="var(--electric-blue)"/></linearGradient></defs>
                           <text x="0" y="29" font-family="Poppins, sans-serif" font-size="26" font-weight="800" fill="url(#logo-gradient)">DHAVA</text><text id="logo-text" x="95" y="29" font-family="Poppins, sans-serif" font-size="26" font-weight="800" fill="var(--text-primary-dark)">FLIX</text>
                        </svg>
                    </a>
                    <nav class="hidden md:flex space-x-6 text-sm font-medium">
                        <a href="#" class="nav-link themed-text transition-transform duration-300 hover:scale-105 active" data-view="home">Home</a>
                        <a href="#" class="nav-link themed-text transition-transform duration-300 hover:scale-105" data-view="tv">TV Shows</a>
                        <a href="#" class="nav-link themed-text transition-transform duration-300 hover:scale-105" data-view="movies">Movies</a>
                        <a href="#" class="nav-link themed-text transition-transform duration-300 hover:scale-105" data-view="comingsoon">Coming Soon</a>
                        <a href="#" class="nav-link themed-text transition-transform duration-300 hover:scale-105" data-view="mylist">My List</a>
                    </nav>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="theme-toggle" class="themed-text p-2 rounded-full hover:bg-gray-700 transition-colors duration-300">🌙</button>
                    <button id="search-button" class="themed-text"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg></button>
                    <a href="#" class="nav-link" data-view="profile">
                        <img src="https://placehold.co/40x40/0072F5/FFFFFF?text=D" alt="Profile" class="w-8 h-8 rounded-md hidden md:block"/>
                    </a>
                </div>
                <div class="md:hidden"><button id="mobile-menu-button" class="themed-text"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg></button></div>
            </div>
        </div>
    </header>

    <!-- MOBILE MENU -->
    <div id="mobile-menu" class="fixed top-0 left-0 h-full w-64 z-40 transform -translate-x-full md:hidden">
        <nav class="mt-24 flex flex-col space-y-6 px-6">
            <a href="#" class="nav-link themed-text text-lg active" data-view="home">Home</a>
            <a href="#" class="nav-link themed-text text-lg" data-view="tv">TV Shows</a>
            <a href="#" class="nav-link themed-text text-lg" data-view="movies">Movies</a>
            <a href="#" class="nav-link themed-text text-lg" data-view="comingsoon">Coming Soon</a>
            <a href="#" class="nav-link themed-text text-lg" data-view="mylist">My List</a>
            <a href="#" class="nav-link themed-text text-lg mt-4 border-t border-gray-700 pt-4" data-view="profile">Profile</a>
        </nav>
    </div>

    <main id="main-content" class="pt-20">
        <section id="hero-section" class="relative min-h-[50vh] md:min-h-[calc(85vh-5rem)] flex items-center justify-center"></section>
        <div id="content-rows-container" class="py-8 md:py-12 space-y-8 md:space-y-12"></div>
    </main>
    
    <footer class="themed-bg themed-text text-center py-6 mt-8 border-t border-gray-700/50 text-sm opacity-80">
      <p>© 2025 DhavaFlix. All Rights Reserved.</p>
      <div class="flex justify-center space-x-4 mt-2">
        <a href="#" class="hover:underline nav-link" data-view="privacy">Privacy Policy</a>
        <span>•</span>
        <a href="#" class="hover:underline nav-link" data-view="about">About Us</a>
        <span>•</span>
        <a href="#" class="hover:underline nav-link" data-view="contact">Contact</a>
      </div>
    </footer>
    
    <!-- MOBILE STICKY NAV -->
    <div class="fixed bottom-0 left-0 right-0 themed-bg bottom-nav flex justify-around py-2 md:hidden z-50 border-t border-gray-700/50">
        <button data-view="home" class="bottom-nav-link flex flex-col items-center text-xs themed-text active"><svg class="w-6 h-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg><span>Home</span></button>
        <button data-view="tv" class="bottom-nav-link flex flex-col items-center text-xs themed-text"><svg class="w-6 h-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg><span>TV</span></button>
        <button data-view="movies" class="bottom-nav-link flex flex-col items-center text-xs themed-text"><svg class="w-6 h-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg><span>Movies</span></button>
        <button data-view="mylist" class="bottom-nav-link flex flex-col items-center text-xs themed-text"><svg class="w-6 h-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg><span>My List</span></button>
    </div>


    <!-- DETAILS MODAL -->
    <div id="details-modal" class="hidden fixed inset-0 z-[100] overflow-y-auto">
        <div class="fixed inset-0 bg-black/80 modal-backdrop" id="modal-backdrop"></div>
        <div class="relative w-full max-w-4xl mx-auto my-8">
            <div id="modal-content-container" class="modal-content bg-midnight-bg rounded-lg shadow-xl"></div>
        </div>
    </div>
    
    <!-- SEARCH OVERLAY -->
    <div id="search-overlay" class="hidden fixed inset-0 z-[60] bg-black/80 search-overlay">
        <div class="container mx-auto px-4 pt-24">
            <button id="close-search" class="absolute top-8 right-8 text-4xl">&times;</button>
            <form id="search-form" class="flex"><input type="text" id="search-input" class="w-full bg-transparent border-b-2 border-electric-blue text-2xl md:text-5xl focus:outline-none" placeholder="Search movies, TV shows..."><button type="submit" class="hidden">Search</button></form>
            <div id="search-results" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mt-8 max-h-[70vh] overflow-y-auto scrollbar-hide"></div>
        </div>
    </div>

    <!-- VIDEO MODAL -->
    <div id="video-modal" class="hidden fixed inset-0 z-[110] flex items-center justify-center bg-black/80">
      <div class="relative w-full max-w-4xl aspect-video bg-black rounded-lg overflow-hidden">
        <iframe id="video-frame" class="w-full h-full" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        <button id="close-video" class="absolute top-2 right-2 text-3xl">&times;</button>
      </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- CONFIG ---
    const apiKey = "0627e9682f6c3eca80da4e2a6217ce57"; // <-- NEW KEY INSERTED HERE
    const apiBaseUrl = "https://api.themoviedb.org/3";
    const imageBaseUrl = "https://image.tmdb.org/t/p/";

    // --- DOM ELEMENTS ---
    const mainContent = document.getElementById('main-content');
    const heroSection = document.getElementById('hero-section');
    const contentContainer = document.getElementById('content-rows-container');
    const modal = document.getElementById('details-modal');
    const modalContentContainer = document.getElementById('modal-content-container');
    const searchOverlay = document.getElementById('search-overlay');
    const searchInput = document.getElementById('search-input');
    const navLinks = document.querySelectorAll('.nav-link');
    const mobileMenu = document.getElementById('mobile-menu');
    const videoModal = document.getElementById('video-modal');
    const videoFrame = document.getElementById('video-frame');
    const closeVideo = document.getElementById('close-video');
    const bottomNavLinks = document.querySelectorAll('.bottom-nav-link');
    const themeToggle = document.getElementById('theme-toggle');

    // --- LOCAL STORAGE & STATE MANAGEMENT ---
    let myList = JSON.parse(localStorage.getItem('dhavaflixMyList')) || [];
    let continueWatching = JSON.parse(localStorage.getItem('dhavaflixContinueWatching')) || [];
    let reminders = JSON.parse(localStorage.getItem('dhavaflixReminders')) || [];
    
    const saveMyList = () => localStorage.setItem('dhavaflixMyList', JSON.stringify(myList));
    const saveContinueWatching = () => localStorage.setItem('dhavaflixContinueWatching', JSON.stringify(continueWatching));
    const saveReminders = () => localStorage.setItem('dhavaflixReminders', JSON.stringify(reminders));
    const addToContinueWatching = (item) => {
        continueWatching = continueWatching.filter(i => i.id !== item.id);
        item.progress = Math.floor(Math.random() * 80) + 10;
        continueWatching.unshift(item);
        if (continueWatching.length > 20) continueWatching.pop();
        saveContinueWatching();
    };

    // --- API & UTILITY HELPERS ---
    const fetchApi = async (path, params = "") => {
        const url = `${apiBaseUrl}/${path}?api_key=${apiKey}&language=en-US${params}`;
        try {
            const res = await fetch(url);
            if (!res.ok) {
                console.error(`API Error: Status ${res.status} for ${url}`);
                contentContainer.innerHTML = `<div class="text-center text-red-500 p-8">Sorry, something went wrong while loading content. Please try again later.</div>`;
                return null;
            }
            return await res.json();
        } catch (err) { console.error(`Failed to fetch ${path}:`, err); return null; }
    };
    const debounce = (func, delay) => { let timeout; return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), delay); }; };

    // --- RENDER FUNCTIONS ---
    const renderSkeletonLoader = () => {
        const skeletonCard = `<div class="flex-shrink-0 w-36 sm:w-48 md:w-56"><div class="w-full aspect-[2/3] themed-bg shimmer rounded-lg shadow-sm"></div></div>`;
        const skeletonRow = `<div class="px-4 sm:px-6 lg:px-8"><div class="h-8 w-1/3 themed-bg shimmer rounded-lg shadow-sm mb-4"></div><div class="flex space-x-4">${skeletonCard.repeat(5)}</div></div>`;
        contentContainer.innerHTML = skeletonRow.repeat(4);
    };

    const renderHero = async (data) => {
        if (!data || !data.results || data.results.length === 0) {
            heroSection.innerHTML = `<div class="text-xl p-4 text-center">Could not load featured content.</div>`; return;
        }
        const item = data.results[Math.floor(Math.random() * Math.min(10, data.results.length))];
        const title = item.title || item.name;
        const type = item.media_type || (item.title ? 'movie' : 'tv');
        const preloadLink = document.createElement('link');
        preloadLink.rel = 'preload'; preloadLink.as = 'image';
        preloadLink.href = `${imageBaseUrl}w1280${item.backdrop_path}`;
        document.head.appendChild(preloadLink);

        heroSection.innerHTML = `<div class="absolute inset-0"><img src="${imageBaseUrl}w1280${item.backdrop_path}" class="w-full h-full object-cover object-top" alt="${title}" loading="eager" onerror="this.style.display='none'"><div class="absolute inset-0 hero-gradient"></div></div><div class="relative z-10 flex flex-col justify-end h-full w-full max-w-7xl px-4 sm:px-6 lg:px-8 pb-10 md:pb-0 md:justify-center"><div class="max-w-xl"><h2 class="text-3xl md:text-6xl font-bold hero-text-shadow">${title}</h2><p class="mt-4 text-sm md:text-lg max-w-lg hero-text-shadow line-clamp-2 md:line-clamp-3">${item.overview}</p><div class="mt-6 flex space-x-4"><button class="play-btn bg-white text-black font-semibold py-2 px-5 rounded flex items-center hover:bg-gray-200 transition duration-300 hover:scale-105" data-id="${item.id}" data-type="${type}"><svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>Play Trailer</button><button class="info-btn bg-gray-700/80 font-semibold py-2 px-5 rounded flex items-center hover:bg-gray-600/70 transition duration-300 hover:scale-105" data-id="${item.id}" data-type="${type}">More Info</button></div></div></div>`;
        attachHeroEventListeners();
    };
    
    const createItemCard = (item, endpoint = '') => {
        if (!item.poster_path) return '';
        const type = item.media_type || (item.title ? 'movie' : 'tv') || (endpoint.includes('movie') ? 'movie' : 'tv');
        const qualityBadge = item.vote_average > 7.0 ? `<div class="quality-badge">HD</div>` : '';
        const progressBar = item.progress ? `<div class="absolute bottom-0 left-0 w-full h-1 bg-gray-500/50 rounded-b-lg"><div class="progress-bar h-1 rounded-b-lg" style="width: ${item.progress}%"></div></div>` : '';
        return `<div class="group flex-shrink-0 w-36 sm:w-48 md:w-56 relative"><div class="movie-card w-full aspect-[2/3] themed-bg rounded-lg overflow-hidden relative"><img src="${imageBaseUrl}w500${item.poster_path}" alt="${item.title || item.name}" class="w-full h-full object-cover" loading="lazy">${qualityBadge}${progressBar}</div><div class="absolute inset-0 bg-black/70 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-lg flex flex-col items-center justify-center p-2 text-center z-20"><h3 class="font-bold text-sm mb-3">${item.title || item.name}</h3><button class="play-trailer-btn w-full bg-white text-black text-sm font-semibold py-2 rounded mb-2 transition hover:scale-105" data-id="${item.id}" data-type="${type}">▶ Play Trailer</button><button class="info-btn w-full bg-gray-700/80 text-sm font-semibold py-2 rounded transition hover:scale-105" data-id="${item.id}" data-type="${type}">ℹ More Info</button></div></div>`;
    };

    const createRowHTML = (title, itemsHTML) => `<div class="carousel-category"><h2 class="text-lg sm:text-2xl font-bold mb-3 md:mb-4 px-4 sm:px-6 lg:px-8">${title}</h2><div class="carousel-container relative"><div class="carousel-wrapper flex overflow-x-auto pb-4 scrollbar-hide px-4 sm:px-6 lg:px-8 space-x-4">${itemsHTML}</div><button class="carousel-arrow left-2 absolute top-0 bottom-0 px-4 bg-black/50 hidden md:flex items-center z-20 rounded-l-lg">&#9664;</button><button class="carousel-arrow right-2 absolute top-0 bottom-0 px-4 bg-black/50 hidden md:flex items-center z-20 rounded-r-lg">&#9654;</button></div></div>`;
    
    const showDetails = async (id, type) => {
        modal.classList.remove('hidden'); document.body.style.overflow = 'hidden';
        modalContentContainer.innerHTML = `<div class="p-8 text-center shimmer h-96 rounded-lg"></div>`;
        const details = await fetchApi(`${type}/${id}`);
        if (!details) { modalContentContainer.innerHTML = `<div class="p-8 text-center">Could not load details.</div>`; return; }
        const [credits] = await Promise.all([ fetchApi(`${type}/${id}/credits`) ]);
        const videos = await fetchApi(`${type}/${id}/videos`);
        const trailer = videos?.results.find(v => v.site === 'YouTube' && v.type === 'Trailer');
        const castHTML = credits?.cast.slice(0, 6).map(person => person.profile_path ? `<div class="text-center"><img src="${imageBaseUrl}w185${person.profile_path}" class="rounded-full w-20 h-20 object-cover mx-auto" loading="lazy"><p class="text-sm mt-2">${person.name}</p><p class="text-xs">${person.character}</p></div>` : '').join('');
        
        modalContentContainer.innerHTML = `<div class="relative"><div class="bg-black h-48 sm:h-64 md:h-80"><img src="${imageBaseUrl}w1280${details.backdrop_path}" class="w-full h-full object-cover object-top opacity-50" onerror="this.style.display='none'"></div><div class="absolute inset-0 bg-gradient-to-t from-midnight-bg via-midnight-bg/80 to-transparent"></div><button id="close-modal" class="absolute top-4 right-4 bg-black/50 rounded-full w-8 h-8 flex items-center justify-center text-2xl leading-none z-10">&times;</button><div class="absolute bottom-0 left-0 p-4 md:p-8"><h2 class="text-2xl md:text-4xl font-bold hero-text-shadow">${details.title || details.name}</h2></div></div><div class="p-4 md:p-8"><div class="flex flex-wrap items-center gap-x-4 gap-y-2 my-3 text-sm"><span>(${(details.release_date || details.first_air_date || 'N/A').substring(0,4)})</span><span>${details.runtime || (details.episode_run_time ? details.episode_run_time[0] : "") || "N/A"} min</span><span class="flex items-center"><svg class="w-4 h-4 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg> ${details.vote_average ? details.vote_average.toFixed(1) : 'N/A'}</span></div><button id="my-list-btn" class="bg-gray-700/80 font-semibold py-2 px-4 rounded w-full my-4 hover:bg-gray-600/70 transition"></button><p class="text-sm md:text-base">${details.overview}</p>${castHTML ? `<div class="mt-6"><h3 class="text-xl font-bold mb-4">Cast</h3><div class="grid grid-cols-3 sm:grid-cols-6 gap-4">${castHTML}</div></div>` : ''}${trailer ? `<div class="mt-6"><h3 class="text-xl font-bold mb-2">Trailer</h3><div class="video-container rounded-lg"><iframe src="https://www.youtube.com/embed/${trailer.key}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div></div>` : ''}</div>`;
        
        document.getElementById('close-modal').addEventListener('click', closeModal);
        const updateMyListButton = () => { const btn = document.getElementById('my-list-btn'); if (!btn) return; const isInList = myList.some(item => item.id === details.id); btn.innerHTML = isInList ? '✓ Added to My List' : '+ Add to My List'; btn.onclick = () => { if (isInList) { myList = myList.filter(item => item.id !== details.id); } else { myList.push({ id: details.id, type, poster_path: details.poster_path, title: details.title || details.name }); } saveMyList(); updateMyListButton(); }; };
        updateMyListButton();
    };
    
    const closeModal = () => { modal.classList.add('hidden'); document.body.style.overflow = 'auto'; };
    const playVideo = async (id, type) => { const data = await fetchApi(`${type}/${id}/videos`); const trailer = data?.results.find(v => v.type === "Trailer" && v.site === "YouTube"); if (trailer) { videoFrame.src = `https://www.youtube.com/embed/${trailer.key}?autoplay=1`; videoModal.classList.remove("hidden"); } else { alert("Trailer not available for this title."); } };

    // --- PAGE VIEW RENDERERS ---
    const renderHomePage = () => {
        mainContent.classList.add('pt-20'); heroSection.style.display = 'flex';
        renderSkeletonLoader();
        const categories = [{ title: "Trending This Week", endpoint: "trending/all/week" }, { title: "Popular in India", endpoint: "discover/movie", params: "&region=IN&sort_by=popularity.desc&with_original_language=hi|te|ta" }, { title: "Top Rated Movies", endpoint: "movie/top_rated" }];
        let contentHTML = '';
        if (continueWatching.length > 0) { contentHTML += createRowHTML("Continue Watching", continueWatching.map(item => createItemCard(item)).join('')); }
        Promise.all(categories.map(category => fetchApi(category.endpoint, category.params)))
            .then(results => {
                results.forEach((data, index) => { if (data && data.results && data.results.length > 0) { contentHTML += createRowHTML(categories[index].title, data.results.map(item => createItemCard(item, categories[index].endpoint)).join('')); } });
                contentContainer.innerHTML = contentHTML;
                attachRowEventListeners();
            });
        fetchApi('trending/all/week').then(renderHero);
    };

    const renderCategoryPage = async (type) => {
        mainContent.classList.add('pt-20'); heroSection.style.display = 'flex';
        renderSkeletonLoader();
        fetchApi(`${type}/popular`).then(renderHero);
        const staticCategories = type === 'movie' ? [ { title: "Now Playing", endpoint: `movie/now_playing`, params: "&region=IN" }, { title: "Top Rated", endpoint: "movie/top_rated" } ] : [ { title: "Popular TV Shows", endpoint: `tv/popular` }, { title: "Top Rated", endpoint: "tv/top_rated" } ];
        let contentHTML = '';
        const staticResults = await Promise.all(staticCategories.map(cat => fetchApi(cat.endpoint, cat.params)));
        staticResults.forEach((data, index) => { if (data && data.results && data.results.length > 0) { contentHTML += createRowHTML(staticCategories[index].title, data.results.map(item => createItemCard(item, staticCategories[index].endpoint)).join('')); } });
        contentContainer.innerHTML = contentHTML;
        try {
            const genreData = await fetchApi(`genre/${type}/list`);
            const genrePromises = genreData.genres.slice(0, 6).map(async (genre) => { const movieData = await fetchApi(`discover/${type}`, `&with_genres=${genre.id}`); if (movieData && movieData.results && movieData.results.length > 0) { return createRowHTML(genre.name, movieData.results.map(movie => createItemCard(movie, `discover/${type}`)).join('')); } return ''; });
            contentContainer.innerHTML += (await Promise.all(genrePromises)).join('');
            attachRowEventListeners(); 
        } catch (err) { console.error(err); }
    };

    const renderListPage = (title, items) => { mainContent.classList.remove('pt-20'); heroSection.style.display = 'none'; const itemsHTML = items.length > 0 ? items.map(item => createItemCard(item)).join('') : `<div class="text-center col-span-full">${title === 'My List' ? '🎬 Your list is empty.' : 'Nothing to show.'}</div>`; contentContainer.innerHTML = `<div class="px-4 sm:px-6 lg:px-8 pt-8"><h1 class="text-2xl md:text-4xl font-bold">${title}</h1></div><div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-4 px-4 sm:px-6 lg:px-8 mt-4">${itemsHTML}</div>`; attachRowEventListeners(); };
    
    const renderComingSoon = async () => { mainContent.classList.remove('pt-20'); heroSection.style.display = 'none'; renderSkeletonLoader(); const data = await fetchApi('movie/upcoming', '&region=IN'); const itemsHTML = data.results.map(item => { const isInReminders = reminders.some(r => r.id === item.id); return `<div class="group"><div class="movie-card w-full aspect-[2/3] themed-bg rounded-lg overflow-hidden relative info-btn" data-id="${item.id}" data-type="movie"><img src="${imageBaseUrl}w500${item.poster_path}" class="w-full h-full object-cover" loading="lazy"></div><div class="flex items-center justify-between mt-2"><p class="font-semibold truncate text-sm">${item.title}</p><button class="reminder-bell p-1 ${isInReminders ? 'active' : ''}" data-id="${item.id}" data-title="${item.title}"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a6 6 0 00-6 6v3.586l-1.707 1.707A1 1 0 003 15h14a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"></path></svg></button></div><p class="text-xs">${new Date(item.release_date).toLocaleDateString('en-IN', { month: 'long', day: 'numeric' })}</p></div>`; }).join(''); contentContainer.innerHTML = `<div class="px-4 sm:px-6 lg:px-8 pt-8"><h1 class="text-2xl md:text-4xl font-bold">Coming Soon</h1></div><div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 gap-x-4 gap-y-8 px-4 sm:px-6 lg:px-8 mt-4">${itemsHTML}</div>`; attachRowEventListeners(); document.querySelectorAll('.reminder-bell').forEach(btn => btn.addEventListener('click', (e) => { const {id, title} = e.currentTarget.dataset; const idNum = parseInt(id); const isIn = reminders.some(r => r.id === idNum); if (isIn) {reminders = reminders.filter(r => r.id !== idNum);} else {reminders.push({id: idNum, title});} saveReminders(); e.currentTarget.classList.toggle('active', !isIn); })); };

    const renderProfilePage = () => {
        mainContent.classList.remove('pt-20'); heroSection.style.display = 'none';
        const continueWatchingHTML = continueWatching.length > 0 ? continueWatching.map(item => createItemCard(item)).join('') : `<p class="col-span-full themed-text">📺 No viewing history yet.</p>`;
        const myListHTML = myList.length > 0 ? myList.map(item => createItemCard(item)).join('') : `<p class="col-span-full themed-text">🎬 Your list is empty.</p>`;
        const remindersHTML = reminders.length > 0 ? reminders.map(r => `<li class="reminder-item themed-bg p-3 rounded-lg">${r.title}</li>`).join('') : `<p class="themed-text">🔔 No reminders set.</p>`;
        contentContainer.innerHTML = `<div class="px-4 sm:px-6 lg:px-8 pt-8"><h1 class="text-3xl font-bold mb-6">Profile & Settings</h1><div class="mb-10"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-semibold">Continue Watching</h2><button id="clear-history-btn" class="text-sm hover:text-electric-blue">Clear History</button></div><div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-4">${continueWatchingHTML}</div></div><div class="mb-10"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-semibold">My List</h2><button id="clear-list-btn" class="text-sm hover:text-electric-blue">Clear List</button></div><div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-4">${myListHTML}</div></div><div class="mb-10"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-semibold">Reminders</h2><button id="clear-reminders-btn" class="text-sm hover:text-electric-blue">Clear Reminders</button></div><ul class="space-y-3 max-w-md">${remindersHTML}</ul></div></div>`;
        attachRowEventListeners();
        document.getElementById('clear-history-btn').addEventListener('click', () => { continueWatching = []; saveContinueWatching(); renderProfilePage(); });
        document.getElementById('clear-list-btn').addEventListener('click', () => { myList = []; saveMyList(); renderProfilePage(); });
        document.getElementById('clear-reminders-btn').addEventListener('click', () => { reminders = []; saveReminders(); renderProfilePage(); });
    };

    const renderPlaceholderPage = (title, content) => {
        mainContent.classList.remove('pt-20'); heroSection.style.display = 'none';
        contentContainer.innerHTML = `<div class="px-4 sm:px-6 lg:px-8 pt-8 max-w-4xl mx-auto"><h1 class="text-3xl font-bold mb-6">${title}</h1><div class="prose prose-invert max-w-none themed-text">${content}</div></div>`;
    };

    // --- MAIN NAVIGATION LOGIC ---
    const updateView = (view) => {
        navLinks.forEach(link => link.classList.toggle('active', link.dataset.view === view));
        bottomNavLinks.forEach(link => link.classList.toggle('active', link.dataset.view === view));
        mobileMenu.classList.add('-translate-x-full');
        window.scrollTo(0, 0);
        switch (view) {
            case 'tv': renderCategoryPage('tv'); break;
            case 'movies': renderCategoryPage('movie'); break;
            case 'mylist': renderListPage("My List", myList); break;
            case 'comingsoon': renderComingSoon(); break;
            case 'profile': renderProfilePage(); break;
            case 'privacy': renderPlaceholderPage('Privacy Policy', '<p>Your privacy is important to us. It is DhavaFlix\'s policy to respect your privacy regarding any information we may collect from you across our website. All user data like "My List" and "Continue Watching" is stored locally in your browser and is not sent to any server.</p>'); break;
            case 'about': renderPlaceholderPage('About Us', '<p>DhavaFlix is a demonstration project designed to showcase modern web technologies. It uses the TMDB API to provide a rich, interactive experience for browsing movies and TV shows, similar to popular streaming services.</p>'); break;
            case 'contact': renderPlaceholderPage('Contact Us', '<p>For any inquiries, please reach out to us via email at contact@dhavaflix.example.com.</p>'); break;
            default: renderHomePage();
        }
    };
    
    // --- EVENT LISTENERS ---
    const attachHeroEventListeners = () => {
        document.querySelector('.play-btn')?.addEventListener('click', (e) => playVideo(e.currentTarget.dataset.id, e.currentTarget.dataset.type));
        document.querySelector('.info-btn')?.addEventListener('click', (e) => showDetails(e.currentTarget.dataset.id, e.currentTarget.dataset.type));
    };
    const attachRowEventListeners = () => {
        document.querySelectorAll('.info-btn').forEach(el => el.addEventListener('click', (e) => { e.stopPropagation(); showDetails(e.currentTarget.dataset.id, e.currentTarget.dataset.type) }));
        document.querySelectorAll('.play-trailer-btn').forEach(el => el.addEventListener('click', (e) => { e.stopPropagation(); playVideo(e.currentTarget.dataset.id, e.currentTarget.dataset.type); }));
        document.querySelectorAll('.carousel-container').forEach(c => { const wrapper = c.querySelector('.carousel-wrapper'); if(wrapper) { c.querySelector('.left-2')?.addEventListener('click', () => wrapper.scrollBy({ left: -wrapper.clientWidth, behavior: 'smooth' })); c.querySelector('.right-2')?.addEventListener('click', () => wrapper.scrollBy({ left: wrapper.clientWidth, behavior: 'smooth' })); } });
    };
    const debouncedSearch = debounce(async (query) => {
        const searchResultsContainer = document.getElementById('search-results');
        if (query) {
            searchResultsContainer.innerHTML = `<div class="col-span-full shimmer h-24 rounded-lg"></div>`.repeat(3);
            const data = await fetchApi(`search/multi`, `&query=${encodeURIComponent(query)}`);
            const results = data ? data.results.filter(item => item.poster_path && item.media_type !== 'person') : [];
            searchResultsContainer.innerHTML = results.length === 0 ? `<p class="col-span-full">No results found.</p>` : results.map(item => createItemCard(item)).join('');
            attachRowEventListeners();
        } else { searchResultsContainer.innerHTML = ''; }
    }, 300);
    searchInput.addEventListener('input', (e) => debouncedSearch(e.target.value.trim()));
    document.getElementById('search-form').addEventListener('submit', (e) => e.preventDefault());

    // --- GLOBAL LISTENERS ---
    window.addEventListener('scroll', () => document.getElementById('main-header').classList.toggle('header-scrolled', window.scrollY > 0));
    navLinks.forEach(link => link.addEventListener('click', (e) => { e.preventDefault(); updateView(e.currentTarget.dataset.view); }));
    bottomNavLinks.forEach(link => link.addEventListener('click', (e) => { e.preventDefault(); updateView(e.currentTarget.dataset.view); }));
    document.getElementById('mobile-menu-button').addEventListener('click', (e) => { e.stopPropagation(); mobileMenu.classList.toggle('-translate-x-full'); });
    document.addEventListener('click', (e) => { if (!mobileMenu.contains(e.target) && !document.getElementById('mobile-menu-button').contains(e.target)) mobileMenu.classList.add('-translate-x-full'); });
    document.getElementById('search-button').addEventListener('click', () => searchOverlay.classList.remove('hidden'));
    document.getElementById('close-search').addEventListener('click', () => searchOverlay.classList.add('hidden'));
    document.getElementById('modal-backdrop').addEventListener('click', () => closeModal());
    closeVideo.addEventListener('click', () => { videoModal.classList.add('hidden'); videoFrame.src = ""; });
    themeToggle.addEventListener("click", () => {
        const isLight = document.documentElement.classList.toggle("light");
        localStorage.setItem("theme", isLight ? "light" : "dark");
        themeToggle.innerHTML = isLight ? '☀️' : '🌙';
        document.querySelector('meta[name="theme-color"]').setAttribute('content', isLight ? '#f1f5f9' : '#101010');
    });

    // --- INITIAL LOAD ---
    if (localStorage.getItem('theme') === 'light') {
        document.documentElement.classList.add('light');
        themeToggle.innerHTML = '☀️';
        document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f1f5f9');
    }
    updateView('home');
});
</script>

</body>
</html>
